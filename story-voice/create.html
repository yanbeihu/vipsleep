<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ›å»ºæ•…äº‹ - æ•…äº‹ä¹‹å£°</title>
    <meta name="description" content="è¾“å…¥å°è¯´æ–‡æœ¬ï¼ŒAIè‡ªåŠ¨åˆ†æè§’è‰²å¹¶ç”Ÿæˆä¸“å±è¯­éŸ³æ•…äº‹">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #1a1a1a;
            background: #f8fafc;
        }

        /* Navigation */
        nav {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            z-index: 1000;
            box-shadow: 0 2px 30px rgba(0,0,0,0.08);
            padding: 1rem 0;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 800;
            color: #667eea;
            text-decoration: none;
            letter-spacing: -1px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo-icon {
            font-size: 1.8rem;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
            align-items: center;
        }

        .nav-links a {
            color: #334e68;
            text-decoration: none;
            font-weight: 500;
            font-size: 0.95rem;
            transition: color 0.3s ease;
        }

        .nav-links a:hover {
            color: #667eea;
        }

        .nav-links a.active {
            color: #667eea;
            font-weight: 600;
        }

        /* Main Content */
        .main-content {
            padding: 8rem 2rem 4rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .page-title {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            color: #0d2137;
        }

        .page-subtitle {
            color: #667e99;
            margin-bottom: 2rem;
        }

        /* Progress Bar */
        .progress-bar {
            display: flex;
            justify-content: center;
            margin-bottom: 3rem;
        }

        .progress-steps {
            display: flex;
            align-items: center;
            gap: 3rem;
        }

        .progress-step {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #667e99;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .progress-step.active {
            color: #667eea;
            font-weight: 600;
        }

        .progress-step.completed {
            color: #10b981;
        }

        .step-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .progress-step.active .step-number {
            background: #667eea;
            color: white;
        }

        .progress-step.completed .step-number {
            background: #10b981;
            color: white;
        }

        .step-line {
            width: 50px;
            height: 2px;
            background: #e2e8f0;
        }

        .progress-step.completed ~ .step-line {
            background: #10b981;
        }

        /* Step Content */
        .step-content {
            display: none;
        }

        .step-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Step 1: Input Text */
        .text-input-section {
            background: white;
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
        }

        .input-group {
            margin-bottom: 1.5rem;
        }

        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #334e68;
            font-weight: 500;
        }

        .input-group textarea,
        .input-group input[type="text"] {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
            font-family: inherit;
        }

        .input-group textarea {
            min-height: 300px;
            resize: vertical;
        }

        .input-group textarea:focus,
        .input-group input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }

        .text-info {
            display: flex;
            justify-content: space-between;
            color: #667e99;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        /* Step 2: Character Analysis */
        .analysis-results {
            background: white;
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
            margin-bottom: 2rem;
        }

        .analysis-loading {
            text-align: center;
            padding: 3rem;
            color: #667e99;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .character-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .character-card {
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .character-card:hover {
            border-color: #667eea;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.1);
        }

        .character-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: #0d2137;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .character-info {
            margin-bottom: 1rem;
        }

        .character-info p {
            color: #667e99;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .character-info strong {
            color: #334e68;
            font-weight: 500;
        }

        /* Voice Selection */
        .voice-selection {
            margin-top: 1rem;
        }

        .voice-label {
            color: #334e68;
            font-weight: 500;
            margin-bottom: 0.5rem;
            display: block;
        }

        .voice-options {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .voice-option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.8rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .voice-option:hover {
            border-color: #667eea;
            background: #f8fafc;
        }

        .voice-option.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        }

        .voice-option input[type="radio"] {
            display: none;
        }

        .voice-name {
            flex: 1;
            font-weight: 500;
            color: #334e68;
        }

        .voice-preview-btn {
            padding: 0.4rem 0.8rem;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .voice-preview-btn:hover {
            background: #5568d3;
        }

        /* Buttons */
        .btn {
            display: inline-block;
            padding: 0.8rem 2rem;
            border-radius: 50px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
            font-size: 1rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-secondary:hover {
            background: #667eea;
            color: white;
        }

        .button-group {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
        }

        /* Step 3: Generate */
        .generate-section {
            background: white;
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
            text-align: center;
            padding: 3rem 2rem;
        }

        .generate-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .generate-title {
            font-size: 1.8rem;
            font-weight: 800;
            color: #0d2137;
            margin-bottom: 1rem;
        }

        .generate-desc {
            color: #667e99;
            margin-bottom: 2rem;
            line-height: 1.7;
        }

        .settings-section {
            text-align: left;
            background: #f8fafc;
            padding: 1.5rem;
            border-radius: 15px;
            margin: 1.5rem 0;
        }

        .settings-section h3 {
            color: #0d2137;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-item label {
            flex: 1;
            color: #334e68;
        }

        .setting-item select,
        .setting-item input[type="range"] {
            padding: 0.5rem 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 0.95rem;
        }

        .setting-item select:focus {
            outline: none;
            border-color: #667eea;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }

            .progress-steps {
                gap: 1rem;
                font-size: 0.85rem;
            }

            .step-line {
                width: 20px;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav>
        <div class="nav-container">
            <a href="index.html" class="logo">
                <span class="logo-icon">ğŸ™ï¸</span>
                æ•…äº‹ä¹‹å£°
            </a>
            <ul class="nav-links">
                <li><a href="index.html">é¦–é¡µ</a></li>
                <li><a href="create.html" class="active">åˆ›å»ºæ•…äº‹</a></li>
                <li><a href="my-stories.html">æˆ‘çš„æ•…äº‹</a></li>
                <li><a href="about.html">å…³äº</a></li>
            </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
        <h1 class="page-title">åˆ›å»ºè¯­éŸ³æ•…äº‹</h1>
        <p class="page-subtitle">è¾“å…¥å°è¯´æ–‡æœ¬ï¼ŒAIå°†è‡ªåŠ¨åˆ†æè§’è‰²å¹¶ç”Ÿæˆä¸“å±è¯­éŸ³</p>

        <!-- Progress Bar -->
        <div class="progress-bar">
            <div class="progress-steps">
                <div class="progress-step active" id="step1-indicator">
                    <span class="step-number">1</span>
                    è¾“å…¥æ–‡æœ¬
                </div>
                <div class="step-line"></div>
                <div class="progress-step" id="step2-indicator">
                    <span class="step-number">2</span>
                    è§’è‰²åˆ†æ
                </div>
                <div class="step-line"></div>
                <div class="progress-step" id="step3-indicator">
                    <span class="step-number">3</span>
                    ç”ŸæˆéŸ³é¢‘
                </div>
            </div>
        </div>

        <!-- Step 1: Input Text -->
        <div class="step-content active" id="step1">
            <div class="text-input-section">
                <div class="input-group">
                    <label for="story-title">æ•…äº‹æ ‡é¢˜</label>
                    <input type="text" id="story-title" placeholder="ä¸ºä½ çš„æ•…äº‹èµ·ä¸ªåå­—...">
                </div>

                <div class="input-group">
                    <label for="story-text">æ•…äº‹å†…å®¹</label>
                    <textarea id="story-text" placeholder="ç²˜è´´æˆ–è¾“å…¥ä½ çš„å°è¯´æ–‡æœ¬...&#10;&#10;ä¾‹å¦‚ï¼š&#10;&#10;å°æ˜æ˜¯ä¸€ä¸ªå¿«ä¹çš„ç”·å­©ï¼Œä»–ä½åœ¨ä¸€ä¸ªç¾ä¸½çš„å°æ‘åº„é‡Œã€‚æ¯å¤©æ—©ä¸Šï¼Œä»–éƒ½ä¼šå»å±±å¡ä¸Šæ”¾ç¾Šã€‚&#10;&#10;æœ‰ä¸€å¤©ï¼Œä»–é‡åˆ°äº†ä¸€ä½ç¥ç§˜çš„è€äºº..."></textarea>
                    <div class="text-info">
                        <span id="char-count">0 / 10000 å­—ç¬¦</span>
                        <span>å»ºè®®è¾“å…¥ 500-5000 å­—ä»¥è·å¾—æœ€ä½³æ•ˆæœ</span>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn btn-secondary" onclick="loadSample()">åŠ è½½ç¤ºä¾‹æ–‡æœ¬</button>
                    <button class="btn btn-primary" onclick="analyzeCharacters()">ä¸‹ä¸€æ­¥ï¼šåˆ†æè§’è‰² â†’</button>
                </div>
            </div>
        </div>

        <!-- Step 2: Character Analysis -->
        <div class="step-content" id="step2">
            <div class="analysis-results">
                <h2 style="margin-bottom: 1.5rem; color: #0d2137;">è§’è‰²åˆ†æç»“æœ</h2>

                <div class="analysis-loading" id="loading">
                    <div class="loading-spinner"></div>
                    <p>AIæ­£åœ¨åˆ†ææ•…äº‹è§’è‰²...</p>
                    <p style="margin-top: 0.5rem; font-size: 0.9rem; color: #999;">è¿™å¯èƒ½éœ€è¦å‡ ç§’é’Ÿ</p>
                </div>

                <div class="character-grid" id="character-grid" style="display: none;">
                    <!-- Characters will be dynamically inserted here -->
                </div>
            </div>

            <div class="button-group">
                <button class="btn btn-secondary" onclick="goToStep(1)">â† ä¸Šä¸€æ­¥</button>
                <button class="btn btn-primary" id="generate-btn" onclick="goToStep(3)" disabled>ä¸‹ä¸€æ­¥ï¼šç”ŸæˆéŸ³é¢‘ â†’</button>
            </div>
        </div>

        <!-- Step 3: Generate Audio -->
        <div class="step-content" id="step3">
            <div class="generate-section">
                <div class="generate-icon">ğŸ¬</div>
                <h2 class="generate-title">å‡†å¤‡ç”Ÿæˆæ•…äº‹éŸ³é¢‘</h2>
                <p class="generate-desc">AIå°†æ ¹æ®æ‚¨é€‰æ‹©çš„è¯­éŸ³é…ç½®ï¼Œä¸ºæ¯ä¸ªè§’è‰²ç”Ÿæˆä¸“å±é…éŸ³ï¼Œå¹¶åˆæˆå®Œæ•´çš„æ•…äº‹éŸ³é¢‘</p>

                <div class="settings-section">
                    <h3>ç”Ÿæˆè®¾ç½®</h3>
                    <div class="setting-item">
                        <label>éŸ³é¢‘æ ¼å¼</label>
                        <select id="audio-format">
                            <option value="mp3">MP3 (æ¨è)</option>
                            <option value="wav">WAV</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label>é‡‡æ ·ç‡</label>
                        <select id="sample-rate">
                            <option value="24000">24000 Hz (æ ‡å‡†)</option>
                            <option value="48000">48000 Hz (é«˜å“è´¨)</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label>è¯­é€Ÿ</label>
                        <select id="speech-rate">
                            <option value="-10">è¾ƒæ…¢ (-10%)</option>
                            <option value="0" selected>æ­£å¸¸ (0%)</option>
                            <option value="10">è¾ƒå¿« (+10%)</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label>èƒŒæ™¯éŸ³ä¹</label>
                        <select id="background-music">
                            <option value="none">æ— </option>
                            <option value="soft">è½»æŸ”éŸ³ä¹</option>
                            <option value="dramatic">æˆå‰§éŸ³ä¹</option>
                        </select>
                    </div>
                </div>

                <div class="button-group" style="justify-content: center; margin-top: 2rem;">
                    <button class="btn btn-secondary" onclick="goToStep(2)">â† ä¿®æ”¹è§’è‰²è®¾ç½®</button>
                    <button class="btn btn-primary" onclick="generateAudio()" style="font-size: 1.2rem; padding: 1rem 3rem;">ğŸ¬ å¼€å§‹ç”Ÿæˆ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // State management
        let currentStep = 1;
        let storyData = {
            title: '',
            text: '',
            characters: [],
            voiceSettings: {}
        };

        // Character definitions
        const availableVoices = {
            female: [
                { id: 'zh_female_xiaohe_uranus_bigtts', name: 'å°è· (æ¸©æŸ”å¥³å£°)', description: 'æ¸©æŸ”ç”œç¾ï¼Œé€‚åˆå¹´è½»å¥³æ€§è§’è‰²' },
                { id: 'zh_female_vv_uranus_bigtts', name: 'Vivi (ä¸­è‹±åŒè¯­)', description: 'çŸ¥æ€§ä¼˜é›…ï¼Œé€‚åˆæˆç†Ÿå¥³æ€§' },
                { id: 'zh_female_xueayi_saturn_bigtts', name: 'é›ªé˜¿å§¨ (å„¿ç«¥è¯»ç‰©)', description: 'äº²åˆ‡æ¸©æš–ï¼Œé€‚åˆé•¿è¾ˆè§’è‰²' },
                { id: 'saturn_zh_female_keainvsheng_tob', name: 'å¯çˆ±å°‘å¥³', description: 'æ´»æ³¼å¯çˆ±ï¼Œé€‚åˆå°‘å¥³è§’è‰²' }
            ],
            male: [
                { id: 'zh_male_m191_uranus_bigtts', name: 'äº‘èˆŸ (ç”·å£°)', description: 'æ²‰ç¨³æ¸©å’Œï¼Œé€‚åˆæˆå¹´ç”·æ€§' },
                { id: 'zh_male_taocheng_uranus_bigtts', name: 'å°å¤© (å°‘å¹´)', description: 'é˜³å…‰å¼€æœ—ï¼Œé€‚åˆå°‘å¹´è§’è‰²' },
                { id: 'zh_male_dayi_saturn_bigtts', name: 'å¤§æ¯… (æ²‰ç¨³)', description: 'åšé‡æœ‰åŠ›ï¼Œé€‚åˆé•¿è€…æˆ–æƒå¨è§’è‰²' }
            ],
            narrator: [
                { id: 'zh_female_xiaohe_uranus_bigtts', name: 'å°è· (å¥³æ€§æ—ç™½)', description: 'æ ‡å‡†å¥³æ€§æ—ç™½å£°éŸ³' },
                { id: 'zh_male_m191_uranus_bigtts', name: 'äº‘èˆŸ (ç”·æ€§æ—ç™½)', description: 'æ ‡å‡†ç”·æ€§æ—ç™½å£°éŸ³' }
            ]
        };

        // Update character count
        document.getElementById('story-text').addEventListener('input', function() {
            const count = this.value.length;
            document.getElementById('char-count').textContent = `${count} / 10000 å­—ç¬¦`;
            storyData.text = this.value;
        });

        document.getElementById('story-title').addEventListener('input', function() {
            storyData.title = this.value;
        });

        // Load sample text
        function loadSample() {
            const sampleText = `å°æ˜æ˜¯ä¸€ä¸ªå¿«ä¹çš„ç”·å­©ï¼Œä»–ä½åœ¨ä¸€ä¸ªç¾ä¸½çš„å°æ‘åº„é‡Œã€‚æ¯å¤©æ—©ä¸Šï¼Œä»–éƒ½ä¼šå»å±±å¡ä¸Šæ”¾ç¾Šã€‚å±±å¡ä¸Šæœ‰ä¸€æ£µå¤è€çš„å¤§æ ‘ï¼Œæ ‘ä¸‹æ˜¯ä»–æœ€å–œæ¬¢çš„åœ°æ–¹ã€‚

ä¸€å¤©æ—©ä¸Šï¼Œå°æ˜åƒå¾€å¸¸ä¸€æ ·æ¥åˆ°å±±å¡ã€‚è¿™æ—¶ï¼Œä»–çœ‹åˆ°ä¸€ä½ç™½å‘è‹è‹çš„è€äººæ­£ååœ¨æ ‘ä¸‹ä¼‘æ¯ã€‚

"å°æœ‹å‹ï¼Œä½ å¥½å•Šã€‚"è€äººå¾®ç¬‘ç€è¯´ã€‚

"æ‚¨å¥½ï¼Œè€äººå®¶ã€‚"å°æ˜ç¤¼è²Œåœ°å›ç­”ã€‚

è€äººçœ‹ç€å°æ˜æ”¾ç¾Šçš„æ ·å­ï¼Œèµè®¸åœ°ç‚¹ç‚¹å¤´ï¼š"ä½ å¾ˆå‹¤å¥‹å•Šã€‚ä½ çŸ¥é“å—ï¼Ÿè¿™æ£µå¤§æ ‘æœ‰ä¸€ç™¾å¤šå¹´å†å²äº†ã€‚"

"å“‡ï¼ŒçœŸçš„å—ï¼Ÿ"å°æ˜æƒŠè®¶åœ°é—®ã€‚

"å½“ç„¶ã€‚"è€äººè¯´ï¼Œ"è¿™æ£µæ ‘è§è¯äº†æ— æ•°äººçš„æ•…äº‹ã€‚å°±åƒä½ æ”¾ç¾Šï¼Œå®ƒä¹Ÿæ¯å¤©éƒ½åœ¨çœ‹ç€ä½ ã€‚"

å°æ˜æ„Ÿåˆ°å¾ˆç¥å¥‡ã€‚ä»é‚£å¤©èµ·ï¼Œä»–æ¯å¤©éƒ½ä¼šå’Œè€äººèŠå¤©ï¼Œå¬è€äººè®²è¿™æ£µå¤§æ ‘çš„æ•…äº‹ã€‚`;

            document.getElementById('story-text').value = sampleText;
            document.getElementById('char-count').textContent = `${sampleText.length} / 10000 å­—ç¬¦`;
            storyData.text = sampleText;
        }

        // Analyze characters
        function analyzeCharacters() {
            const text = document.getElementById('story-text').value.trim();
            if (!text) {
                alert('è¯·è¾“å…¥æ•…äº‹å†…å®¹ï¼');
                return;
            }

            // Mock character analysis (in real implementation, this would call an AI API)
            storyData.characters = [
                {
                    name: 'å°æ˜',
                    gender: 'male',
                    age: 'child',
                    personality: 'å¿«ä¹ã€å¥½å¥‡ã€æœ‰ç¤¼è²Œ',
                    dialogueCount: 3,
                    description: 'æ•…äº‹çš„ä¸»è§’ï¼Œä¸€ä¸ªå‹¤å¥‹çš„æ”¾ç¾Šç”·å­©'
                },
                {
                    name: 'è€äºº',
                    gender: 'male',
                    age: 'elderly',
                    personality: 'æ™ºæ…§ã€æ¸©å’Œã€å’Œè”¼',
                    dialogueCount: 4,
                    description: 'ä¸€ä½ç™½å‘è‹è‹çš„æ™ºè€…ï¼ŒçŸ¥æ™“å¤§æ ‘çš„ç§˜å¯†'
                }
            ];

            // Add narrator
            storyData.characters.push({
                name: 'æ—ç™½',
                gender: 'narrator',
                age: 'neutral',
                personality: 'å¹³é™ã€å®¢è§‚',
                dialogueCount: 0,
                description: 'æ•…äº‹å™è¿°è€…'
            });

            renderCharacters();
            goToStep(2);
        }

        // Render character cards
        function renderCharacters() {
            const grid = document.getElementById('character-grid');
            grid.innerHTML = '';

            storyData.characters.forEach((character, index) => {
                const voices = character.gender === 'narrator' ? availableVoices.narrator :
                               character.gender === 'female' ? availableVoices.female :
                               availableVoices.male;

                const card = document.createElement('div');
                card.className = 'character-card';
                card.innerHTML = `
                    <div class="character-name">
                        ${character.gender === 'narrator' ? 'ğŸ“–' : (character.gender === 'female' ? 'ğŸ‘©' : 'ğŸ‘¨')}
                        ${character.name}
                        ${character.gender === 'narrator' ? '<span style="font-size: 0.8rem; color: #667eea;">(æ—ç™½)</span>' : ''}
                    </div>
                    <div class="character-info">
                        <p><strong>æ€§åˆ«ï¼š</strong>${character.gender === 'narrator' ? 'æ—ç™½' : (character.gender === 'female' ? 'å¥³' : 'ç”·')}</p>
                        <p><strong>å¹´é¾„ï¼š</strong>${character.age === 'child' ? 'å„¿ç«¥' : (character.age === 'elderly' ? 'è€äºº' : 'æˆå¹´')}</p>
                        <p><strong>æ€§æ ¼ï¼š</strong>${character.personality}</p>
                        <p><strong>æè¿°ï¼š</strong>${character.description}</p>
                    </div>
                    <div class="voice-selection">
                        <label class="voice-label">é€‰æ‹©è¯­éŸ³ï¼š</label>
                        <div class="voice-options">
                            ${voices.map((voice, vIndex) => `
                                <div class="voice-option ${vIndex === 0 ? 'selected' : ''}" data-character="${index}" data-voice="${voice.id}">
                                    <input type="radio" name="voice-${index}" value="${voice.id}" ${vIndex === 0 ? 'checked' : ''}>
                                    <span class="voice-name">${voice.name}</span>
                                    <button class="voice-preview-btn" onclick="previewVoice('${voice.id}', event)">è¯•å¬</button>
                                </div>
                                ${voice.description ? `<p style="font-size: 0.85rem; color: #999; margin-left: 2rem;">${voice.description}</p>` : ''}
                            `).join('')}
                        </div>
                    </div>
                `;
                grid.appendChild(card);

                // Set default voice
                storyData.voiceSettings[character.name] = voices[0].id;
            });

            // Add click handlers
            document.querySelectorAll('.voice-option').forEach(option => {
                option.addEventListener('click', function(e) {
                    const characterIndex = this.dataset.character;
                    const voiceId = this.dataset.voice;
                    const characterName = storyData.characters[characterIndex].name;

                    // Update visual selection
                    document.querySelectorAll(`.voice-option[data-character="${characterIndex}"]`)
                        .forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');

                    // Update radio button
                    this.querySelector('input').checked = true;

                    // Save voice setting
                    storyData.voiceSettings[characterName] = voiceId;

                    // Enable generate button
                    document.getElementById('generate-btn').disabled = false;
                });
            });
        }

        // Preview voice
        function previewVoice(voiceId, event) {
            event.stopPropagation();
            alert(`è¯­éŸ³è¯•å¬åŠŸèƒ½\n\næ­£åœ¨è¯•å¬è¯­éŸ³ï¼š${voiceId}\n\nï¼ˆå®é™…éƒ¨ç½²æ—¶å°†æ’­æ”¾ç¤ºä¾‹éŸ³é¢‘ï¼‰`);
        }

        // Navigate between steps
        function goToStep(step) {
            // Hide all step content
            document.querySelectorAll('.step-content').forEach(content => {
                content.classList.remove('active');
            });

            // Show target step
            document.getElementById(`step${step}`).classList.add('active');

            // Update progress indicators
            for (let i = 1; i <= 3; i++) {
                const indicator = document.getElementById(`step${i}-indicator`);
                if (i < step) {
                    indicator.classList.add('completed');
                    indicator.classList.remove('active');
                } else if (i === step) {
                    indicator.classList.add('active');
                    indicator.classList.remove('completed');
                } else {
                    indicator.classList.remove('active', 'completed');
                }
            }

            currentStep = step;
            window.scrollTo({ top: 0, behavior: 'smooth' });

            // Show loading animation for step 2
            if (step === 2) {
                document.getElementById('loading').style.display = 'block';
                document.getElementById('character-grid').style.display = 'none';

                setTimeout(() => {
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('character-grid').style.display = 'grid';
                    document.getElementById('generate-btn').disabled = false;
                }, 1500);
            }
        }

        // Generate audio
        function generateAudio() {
            const audioFormat = document.getElementById('audio-format').value;
            const sampleRate = document.getElementById('sample-rate').value;
            const speechRate = document.getElementById('speech-rate').value;
            const bgMusic = document.getElementById('background-music').value;

            // In real implementation, this would call an API to generate the audio
            const generateParams = {
                title: storyData.title || 'æœªå‘½åæ•…äº‹',
                text: storyData.text,
                characters: storyData.characters,
                voices: storyData.voiceSettings,
                settings: {
                    format: audioFormat,
                    sampleRate: sampleRate,
                    speechRate: speechRate,
                    backgroundMusic: bgMusic
                }
            };

            console.log('Generating audio with params:', generateParams);

            // Redirect to preview page (in real implementation, would pass data via URL or storage)
            alert(`éŸ³é¢‘ç”Ÿæˆå·²å¼€å§‹ï¼\n\næ•…äº‹ï¼š${generateParams.title}\nè§’è‰²æ•°ï¼š${generateParams.characters.length}\néŸ³é¢‘æ ¼å¼ï¼š${generateParams.settings.format}\n\nï¼ˆå®é™…éƒ¨ç½²æ—¶å°†è·³è½¬åˆ°é¢„è§ˆé¡µé¢ï¼‰`);

            // For demo, redirect to my-stories
            window.location.href = 'my-stories.html';
        }
    </script>
</body>
</html>
